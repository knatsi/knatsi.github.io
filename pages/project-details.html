<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KnaTsi | Project Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

  <!-- Spacer for fixed navbar -->
  <div class="pt-20"></div>

  <!-- Project Viewer -->
  <main class="flex-grow">
    <div id="project-viewer" class="w-full h-[calc(100vh-5rem)] flex items-center justify-center">
      <p class="text-gray-500">Loading project...</p>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-gray-300 py-6 text-center">
    <p>© 2025 <span class="text-teal-400 font-semibold">KnaTsi</span>. All rights reserved.</p>
  </footer>

  <script>
    // Extract project ID (e.g., ?id=ecg-ladder)
    const params = new URLSearchParams(window.location.search);
    const projectId = params.get("id");

    // Load JSON and find project
    fetch("../assets/projects.json")
      .then(res => res.json())
      .then(projects => {
        const project = projects.find(p => p.id === projectId);
        const container = document.getElementById("project-viewer");

        if (!project) {
          container.innerHTML = `
            <div class="text-center p-10">
              <h1 class="text-3xl font-bold text-gray-600 mb-4">Project not found</h1>
              <a href="projects.html" class="text-teal-600 hover:underline">← Back to projects</a>
            </div>`;
          return;
        }

        // Load the project link (GitHub page or any external URL)
        container.innerHTML = `
          <iframe
            src="${project.github || project.link}"
            class="w-full h-[calc(100vh-5rem)] border-none"
            frameborder="0"
          ></iframe>
        `;
      })
      .catch(err => {
        console.error(err);
        document.getElementById("project-viewer").innerHTML = `
          <p class="text-center text-red-600 p-10">Error loading project data.</p>`;
      });
      if (projectId) {
        fetch("https://api.github.com/repos/knatsi/smtp2go-relay/actions/workflows/update-views.yml/dispatches", {
          method: "POST",
          headers: {
            "Accept": "application/vnd.github+json",
            "Authorization": "Bearer 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",
          },
          body: JSON.stringify({
            ref: "main", // or your default branch
            inputs: { project_id: projectId }
          })
        });
      }
  </script>
</body>
</html>
